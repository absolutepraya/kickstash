{% extends 'base.html' %} {% load static %} {% block meta %}
<title>KickStash!</title>
{% endblock meta %} {% block content %} {% include 'navbar.html' with current_page='main' %}
<div class="overflow-x-hidden md:px-8 px-4 pt-32 min-h-screen bg-[#0d0d0d] flex flex-col w-screen space-y-12 items-center text-[#cccccc]">
	<div class="items-center justify-center relative md:hidden">
		<h1 class="text-5xl font-extrabold text-center relative text-white">
			<img src="{% static 'image/crown.png' %}" alt="KickStash Crown" class="absolute w-4 h-4 -top-0.5 -left-1.5 rotate-[-30deg]" />
			KickStash!
		</h1>
	</div>
	<img src="{% static 'image/promo/hoka.webp' %}" alt="Weekend" class="w-full rounded-xl" />
	<div class="flex flex-col space-y-8 w-full">
		<div class="relative flex flex-row space-x-4 w-full justify-start items-center">
			<p class="font-semibold text-2xl tracking-widest text-nowrap">My Products</p>
			<div class="w-full h-0.5 bg-[#262626] w-auto flex-grow"></div>
			<div id="my-products" class="absolute -top-32"></div>
		</div>
		<div class="flex justify-start w-full">
			<a href="{% url 'main:create_product' %}" class="bg-[#0b79f7] hover:bg-opacity-100 hover:text-white bg-opacity-10 text-[#0b79f7] border border-[#0b79f7] font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform flex-row space-x-2 flex items-center justify-center add-button">
				<div class="relative w-4 h-4">
					<img src="{% static 'image/add.svg' %}" alt="Add new product" class="w-4 h-4 add-icon absolute inset-0 transition-opacity duration-300" />
					<img src="{% static 'image/addhover.svg' %}" alt="Add new product" class="w-4 h-4 add-icon-hover absolute inset-0 opacity-0 transition-opacity duration-300" />
				</div>
				<style>
					.add-icon-hover {
						opacity: 0;
					}

					.add-button:hover .add-icon-hover {
						opacity: 1;
					}

					.add-button:hover .add-icon {
						opacity: 0;
					}
				</style>
				<p>Add New Product</p>
			</a>
		</div>

		{% comment %} {% if not products %}
		<div class="w-full flex flex-col items-center justify-center space-y-2 !mb-12">
			<p>No products available.</p>
			<img src="{% static 'image/noproduct.png' %}" alt="No product" class="w-[70px]" />
		</div>
		{% else %}
		<div class="w-full grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 md:gap-6 gap-2 !mb-12">{% for product in products %} {% include 'card_product.html' with product=product %} {% endfor %}</div>
		{% endif %} {% endcomment %}

		<div id="product_cards"></div>
	</div>
</div>

<script>
	function truncateDescription(description, n) {
		if (description.length <= n) {
			return description;
		}
		const truncated = description.substr(0, n);
		return truncated.substr(0, truncated.lastIndexOf(' ')) + '...';
	}

	async function getProducts() {
		return fetch("{% url 'main:show_json' %}").then((res) => res.json());
	}

	async function refreshProducts() {
		document.getElementById('product_cards').innerHTML = '';
		document.getElementById('product_cards').className = '';
		const products = await getProducts();
		let htmlString = '';
		let classNameString = '';

		if (products.length === 0) {
			classNameString = 'w-full flex flex-col items-center justify-center space-y-2 !mb-12';
			htmlString = `
				<p>No products available.</p>
				<img src="{% static 'image/noproduct.png' %}" alt="No product" class="w-[70px]" />
			`;
		} else {
			classNameString = 'w-full grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 md:gap-6 gap-2 !mb-12';
			products.forEach((item) => {
				htmlString += `
					<div class="text-[#cccccc] relative md:w-full shadow-md rounded-2xl break-inside-avoid flex flex-col border-t-2 border-l-2 transform hover:rotate-1 transition-transform duration-300 md:p-4 p-2 items-center space-y-3 border-[#2a2a2a] shadow-lg md:h-[34rem] lg:h-[39rem] h-[24rem] bg-gradient-to-br from-[#1f1f1f] to-[#0e0e0e]">
						<div class="w-full !aspect-square rounded-xl overflow-hidden flex items-center justify-center bg-[#262626]">
							<img src="{% static 'image/noimage.svg' %}" alt="No image available" class="w-1/4 h-1/4 object-cover rounded-lg" />
						</div>
						<div class="w-full flex flex-col space-y-2 justify-start overflow-hidden">
							<p class="md:text-xl text-lg font-semibold leading-6 text-nowrap">${item.fields.name}</p>
							<p class="md:flex hidden md:text-base text-sm">${truncateDescription(item.fields.description, 80)}</p>
							<p class="md:hidden md:text-base text-sm">${truncateDescription(item.fields.description, 30)}</p>
							<div class="flex md:flex-row md:space-x-2 flex-col space-y-2 md:items-end">
								<div class='flex flex-row space-x-2 items-center '>
									<img src="{% static 'image/star.svg' %}" alt="Rate" class="md:w-4 md:h-4 h-3 w-3" />
									<p class="md:text-sm text-xs">Unrated</p>
								</div>
								<p class="md:text-sm text-xs hidden md:flex md:items-center">âˆ™</p>
								<p class="md:text-sm text-xs md:items-center">${item.fields.stock} stock left</p>
							</div>
						</div>
						<div class="absolute bottom-6 left-1/2 -translate-x-1/2 flex flex-row w-full items-center justify-center">
							<a href="/edit-product/${item.pk}" class="w-1/3 flex items-center justify-center flex-row items-center justify-center rounded-l-lg px-1 py-1 md:space-x-1 transition duration-300 bg-yellow-600 hover:bg-opacity-100 hover:text-white bg-opacity-10 text-yellow-600 border border-yellow-600">
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil">
									<path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z" />
									<path d="m15 5 4 4" />
								</svg>
								<p class="hidden md:flex">Edit</p>
							</a>
							<a href="/delete-product/${item.pk}" class="w-1/3 flex items-center justify-center flex-row items-center justify-center rounded-r-lg px-1 py-1 md:space-x-1 transition duration-300 bg-red-800 hover:bg-opacity-100 hover:text-white bg-opacity-20 text-red-600 border border-red-700">
								<p class="hidden md:flex">Delete</p>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eraser">
									<path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21" />
									<path d="M22 21H7" />
									<path d="m5 11 9 9" />
								</svg>
							</a>
						</div>
					</div>
				`;
			});
		}
		document.getElementById('product_cards').innerHTML = htmlString;
		document.getElementById('product_cards').className = classNameString;
	}
	refreshProducts();
</script>

{% include 'footer.html' with student_name=student_name student_id=student_id student_class=student_class %} {% endblock content %}
